/*
 * to8to-webframework
 * description: 框架工具函数
 * version - v1.0 2015/6/12 0012
 * author carl.wu<carl.wu@corp.to8to.com>
 * http://www.to8to.com/
 * 
 */

var fs         = require('fs');
var Logger     = require('tcake-main/libs/Logger');
var configFile = "Tcake-config.json";

module.exports = {

    scanFloder: function (path) {
        var fileList   = [],
            folderList = [],
            walk       = function (path, fileList, folderList) {
                files = fs.readdirSync(path);
                files.forEach(function (item) {
                    var tmpPath = path + '/' + item,
                        stats   = fs.statSync(tmpPath);

                    if (stats.isDirectory()) {
                        walk(tmpPath, fileList, folderList);
                        folderList.push(tmpPath);
                    } else {
                        fileList.push(tmpPath);
                    }
                });
            };

        walk(path, fileList, folderList);

        return {
            'files': fileList,
            'folders': folderList
        }
    },

    parseJSON: function (path) {
        // 加载Tcake-config.json
        var jsonString = fs.readFileSync(path, {
            encoding: 'UTF-8'
        });

        if (!fs.existsSync(path)) {
            Logger.error("Missing Tcake-config.json");
            return false;
        }

        // config文件解析
        try {
            return JSON.parse(jsonString);
        } catch (e) {
            Logger.error("Tcake-config.json format error!");
            return false;
        }
    },

    loadConfig: function () {
        return this.parseJSON(configFile);
    },

    /**
     * 获取命令行参数
     * @returns {Array}
     */
    getArguments: function(argv) {
        var _arguments = [],
            argv = argv || process.argv;
        argv.forEach(function(val, index, array) {
            // 第一个参数是node，第二个参数是当前脚本名
            if (index > 1) {
                _arguments.push(val);
            }
        });

        return _arguments;
    }

};
